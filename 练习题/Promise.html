<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <script>
    // ————————————————————————————————————————————————————
    // const first = () =>
    //   new Promise((resolve, reject) => {
    //     console.log(3); // 同步1 3
    //     let p = new Promise((resolve, reject) => {
    //       console.log(7); //同步2 7
    //       setTimeout(() => {
    //         console.log(5); // 异步1 5
    //         resolve(6);
    //         console.log(p); // 异步2 fulfilled 1
    //       }, 0);
    //       resolve(1);
    //     });
    //     resolve(2);
    //     p.then(arg => {
    //       console.log(arg); // 微任务1 1
    //     });
    //   });

    // first().then(arg => {
    //   console.log(arg); //微任务2 2
    // });

    // console.log(4); //同步3 4
    // ————————————————————————————————————————————————————

    // let a;
    // const b = new Promise((resolve, reject) => {
    //   console.log("promise1"); // 同步1 promise1
    //   resolve();
    // }).then(() => {
    //   console.log("promise2"); // 微1 promise2
    // }).then(() => {
    //   console.log("promise3") // 微2 promise3
    // }).then(() => {
    //   console.log("promise4") // 微3 promise4
    // });
    // a = new Promise(async (resolve, reject) => {
    //   console.log(a); // 同步2 undefined
    //   console.log(b); // Promise fulfilled
    //   await b; // 等待b执行结束后，代码继续往下执行
    //   console.log(a); // 在等待b的时候 new Promise已经完成，promise pending
    //   console.log("after1"); // after1
    //   await a; // 等待a的处理结果，a 的结果在await之后，所以会一直等待
    //   resolve(true);
    //   console.log("after2");
    // });
    // console.log("end"); // 同步3 end

    // ————————————————————————————————————————————————————
    // function runAsync(x) {
    //   const p = new Promise(resolve => {
    //     setTimeout(() => {
    //       resolve(x, console.log(x));
    //     }, 1000);
    //   })
    //   return p;
    // }

    // function runReject(x) {
    //   const p = new Promise((res, rej) => {
    //     setTimeout(() => {
    //       rej(`Error:${x}`, console.log(x))
    //     }, 1000 * x);
    //   });
    //   return p;
    // }

    // // 所有的Promise都成功了，res才会打印成功的值
    // Promise.all([runAsync(1), runReject(4), runAsync(3), runReject(2)])
    //   // 13 一起出现，因为时间一样，先2后4，2的错误先到，打印错误2
    //   .then(res => console.log(res))
    //   .catch(err => console.log(err));
    // ————————————————————————————————————————————————————
    // function runAsync(x) {
    //   const p = new Promise(r => {
    //     setTimeout(() => r(x, console.log(x)), 1000)
    //   });
    //   return p;
    // }
    // // 123一起执行，启动三个定时器，123都会打印，1最先返回成功
    // Promise.race([runAsync(1), runAsync(2), runAsync(3)])
    //   // res的结果，接收返回最快的值
    //   .then(res => console.log("result:", res))
    //   .catch(err => console.log(err));
    // ————————————————————————————————————————————————————
    // async function async1() {
    //   // async没有await，剩下的代码都是同步代码
    //   console.log("1"); // 同步1
    //   // promise 的参数是个函数，这个函数是同步执行的
    //   new Promise(resolve => {
    //     // 直接执行
    //     resolve();
    //     console.log("2"); // 同步 2
    //   });
    //   console.log("3"); // 同步3
    // }
    // async1();
    // console.log("4"); // 同步4
    // ————————————————————————————————————————————————————
    // async function async1() {
    //   console.log("1"); // 同步1
    //   await async2(); // 等待 async2 执行完，包括里面的异步
    //   console.log("2"); // 微任务1
    // }
    // async function async2() {
    //   setTimeout(() => {
    //     console.log("3"); // 异步 1 
    //   }, 0);
    //   console.log("4"); // 同步2
    // }
    // async1();
    // console.log(5); // 同步4
    // ————————————————————————————————————————————————————

    // async function async1() {
    //   console.log(1); // 同步1
    //   await async2(); // 等待async2()
    //   /* 微任务区域 */
    //   console.log(2); // async2了就执行
    //   setTimeout(() => {
    //     console.log(3); // 异步3
    //   }, 0);
    //   /* 微任务区域 */
    // }
    // async function async2() {
    //   // 最先注册的计时器
    //   setTimeout(() => {
    //     console.log(4); // 异步1
    //   }, 0);
    //   console.log(5); // 同步2
    // }

    // async1(); // 从这里开始执行
    // // async1();卡住了就继续执行当前宏任务
    // setTimeout(() => {
    //   console.log(6); // 异步2
    // }, 0);
    // console.log(7); // 同步3

    // ————————————————————————————————————————————————————

    // async function async1() {
    //   console.log("1"); // 同步 2
    //   /* 这里的 Promise 是 pending 状态所以下面的代码不回执行 */
    //   await new Promise(resolve => {
    //     console.log("2"); // 同步3 因为是在括号里的
    //   });

    //   /* ↓是微任务 */
    //   console.log("3");
    //   return "4";
    // }
    // console.log("5"); // 同步1
    // async1().then(res => console.log(res));
    // console.log("6"); // 同步 4

    // ————————————————————————————————————————————————————

    // async function async1() {
    //   console.log("1"); // 同步2
    //   await new Promise(resolve => {
    //     console.log("2"); // 同步3
    //     resolve("3");
    //     // 继续按照代码顺序执行
    //   }).then(res => console.log(res)); // 微1
    //   console.log("4"); // 微2
    //   return "5";
    // }
    // console.log("6"); // 同步1
    // async1().then(res => console.log(res)); // 微3
    // console.log("7"); // 同步4

    
    // ————————————————————————————————————————————————————

    
    // ————————————————————————————————————————————————————
  </script>
</body>

</html>